[{"id":0,"href":"/docs/start/","title":"はじめに","section":"Docs","content":" はじめに # 本ハンズオンでは、LOD(Linked Open Data)として公開されている文化・芸術に関する情報に対して、 クエリ言語SPARQLを用いた活用方法をご紹介します。\n実際の公開SPARQLエンドポイントを利用して、簡単なデータを取得するクエリから、複数のデータベースを横断するような応用的なクエリまでを実践します。\n事前準備 # WebブラウザがあればOKです。\nSPARQLをはじめて扱う方は、導入として以下の資料などを参照していただくのがオススメです。\nLinked Open Data 勉強会2020 資料 - SPARQLの簡単な使い方 ナレッジグラフ推論チャレンジ2021「技術勉強会」 - ナレッジグラフ（RDF）の基礎/ナレッジグラフ（RDF）用クエリ言語SPARQLの基礎 クエリの仕様 # 本ハンズオンでは、基本的にSPARQL 1.1に準拠したクエリを扱います。\nSPARQL 1.1 Query Language ただし、一部のSPARQLエンドポイントにおいては、特定のRDFストアの実装に依存した機能を利用することがあります。\n"},{"id":1,"href":"/docs/mediaartsdb/","title":"メディア芸術データベース","section":"Docs","content":" メディア芸術データベース(ベータ版) # https://mediaarts-db.bunka.go.jp/\nメディア芸術データベース・ラボ (MADB Lab) # https://mediag.bunka.go.jp/madb_lab/\nSPARQLクエリサービス データセット (Turtle, JSON-LD) GitHubリポジトリ スキーマ仕様書 Ver. 1.1 独自に定義する語彙 クラス プロパティ SPARQLクエリエディタ # Endpoint: https://mediag.bunka.go.jp/sparql クエリ集 # 全リソースを種別ごとに集計する # 1PREFIX schema: \u0026lt;https://schema.org/\u0026gt; 2PREFIX class: \u0026lt;https://mediaarts-db.bunka.go.jp/data/class#\u0026gt; 3 4SELECT 5 ?additionalType ?class ?genre (COUNT(*) AS ?count) 6WHERE { 7 ?resource a ?class; 8 schema:additionalType ?additionalType ; 9 schema:genre ?genre . 10} 11GROUP BY ?class ?additionalType ?genre 12ORDER BY ?additionalType ▶ 実行する マンガ単行本の一覧を取得する # 「マンガ単行本」を表すクラス https://mediaarts-db.bunka.go.jp/data/class#MangaBook\n1PREFIX rdfs: \u0026lt;http://www.w3.org/2000/01/rdf-schema#\u0026gt; 2PREFIX schema: \u0026lt;https://schema.org/\u0026gt; 3PREFIX ma: \u0026lt;https://mediaarts-db.bunka.go.jp/data/property#\u0026gt; 4PREFIX class: \u0026lt;https://mediaarts-db.bunka.go.jp/data/class#\u0026gt; 5 6SELECT 7 ?id ?label ?creator ?datePublished 8WHERE { 9 ?item a class:MangaBook ; 10 schema:identifier ?id ; 11 rdfs:label ?label ; 12 schema:creator ?creator ; 13 schema:datePublished ?datePublished . 14} 15LIMIT 1000 ▶ 実行する マンガ単行本とその所蔵館の一覧を取得する # https://mediaarts-db.bunka.go.jp/id/M464950 を主語とするTurtle形式のRDFデータ\n1\u0026lt;https://mediaarts-db.bunka.go.jp/id/M464950\u0026gt; 2 a class:MangaBook ; 3 rdfs:label \u0026#34;鬼滅の刃 1\u0026#34; ; 4 schema:identifier \u0026#34;M464950\u0026#34; ; 5 schema:additionalType class:CM ; 6 schema:genre \u0026#34;マンガ単行本\u0026#34; ; 7 dcterms:creator \u0026lt;https://mediaarts-db.bunka.go.jp/id/C53400\u0026gt; ; 8 dcterms:publisher \u0026#34;P4080000000\u0026#34; ; 9 ma:jpno \u0026#34;22740403\u0026#34; ; 10 ma:ndc \u0026#34;726.1\u0026#34; ; 11 ma:note \u0026#34;【言語】日本語　／　JPN\u0026#34; ; 12 schema:alternateName \u0026#34;残酷\u0026#34; ; 13 schema:brand \u0026#34;ジャンプコミックス\u0026#34; , \u0026#34;ジャンプ コミックス\u0026#34;@ja-Hrkt-Hrkt ; 14 schema:creator \u0026#34;[著]吾峠呼世晴\u0026#34; ; 15 schema:datePublished \u0026#34;2016-06-08\u0026#34; ; 16 schema:description \u0026#34;残酷\u0026#34; ; 17 schema:inLanguage \u0026#34;日本語\u0026#34; ; 18 schema:isPartOf \u0026lt;https://mediaarts-db.bunka.go.jp/id/C361806\u0026gt; ; 19 schema:isbn \u0026#34;9784088807232\u0026#34; ; 20 schema:location \u0026#34;東京\u0026#34; ; 21 schema:name \u0026#34;キメツ ノ ヤイバ\u0026#34;@ja-Hrkt-Hrkt , \u0026#34;鬼滅の刃\u0026#34; ; 22 schema:position \u0026#34;1.0\u0026#34; ; 23 schema:provider [ ma:materialIdentifier \u0026lt;https://id.ndl.go.jp/bib/027321240\u0026gt; ; 24 ma:note \u0026#34;2016-06\u0026#34; ; 25 ma:ownerIdentifier \u0026#34;2\u0026#34; ; 26 ma:subMaterialIdentifier \u0026#34;1\u0026#34; ; 27 schema:name \u0026#34;国立国会図書館\u0026#34; ; 28 schema:price \u0026#34;400円\u0026#34; 29 ] ; 30 schema:provider [ ma:materialIdentifier \u0026#34;10071400016547\u0026#34; ; 31 ma:note \u0026#34;1刷　／　付:帯・カバー　／　付:「ジャンパラ!」(JUMP PARADISE) Vol.156\u0026#34; ; 32 ma:ownerIdentifier \u0026#34;6\u0026#34; ; 33 ma:subMaterialIdentifier \u0026#34;1\u0026#34; ; 34 schema:name \u0026#34;大阪府立中央図書館国際児童文学館\u0026#34; ; 35 schema:price \u0026#34;400円\u0026#34; 36 ] ; 37 schema:publisher \u0026#34;集英社　∥　シュウエイシャ\u0026#34; ; 38 schema:size \u0026#34;18cm　／　18cm　×　12cm\u0026#34; ; 39 schema:volumeNumber \u0026#34;1\u0026#34; . 空白ノードの構文を使ってパターンを指定します。\n1PREFIX rdfs: \u0026lt;http://www.w3.org/2000/01/rdf-schema#\u0026gt; 2PREFIX schema: \u0026lt;https://schema.org/\u0026gt; 3PREFIX ma: \u0026lt;https://mediaarts-db.bunka.go.jp/data/property#\u0026gt; 4PREFIX class: \u0026lt;https://mediaarts-db.bunka.go.jp/data/class#\u0026gt; 5 6SELECT 7 ?id ?label ?creator ?datePublished ?providerName 8WHERE { 9 ?item a class:MangaBook ; 10 schema:identifier ?id ; 11 rdfs:label ?label ; 12 schema:creator ?creator ; 13 schema:datePublished ?datePublished ; 14 schema:provider [ 15 schema:name ?providerName 16 ] . 17} 18LIMIT 1000 ▶ 実行する 参考: MADB Lab: データ利活用例その２：マンガの連携機関所蔵リスト\n公開年毎にアニメテレビレギュラーシリーズ数を集計 # 1PREFIX schema: \u0026lt;https://schema.org/\u0026gt; 2PREFIX rdf: \u0026lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#\u0026gt; 3PREFIX rdfs: \u0026lt;http://www.w3.org/2000/01/rdf-schema#\u0026gt; 4PREFIX class: \u0026lt;https://mediaarts-db.bunka.go.jp/data/class#\u0026gt; 5SELECT ?y (COUNT(DISTINCT *) AS ?cnt) WHERE { 6 ?s a class:AnimationTVRegularSeries ; 7 schema:datePublished ?datePublished . 8} 9GROUP BY (SUBSTR(?datePublished, 1, 4) AS ?y) 10ORDER BY ASC(?y) ▶ 実行する 登場キャラクター名がタイトルのアニメシリーズ # 1PREFIX schema: \u0026lt;https://schema.org/\u0026gt; 2PREFIX rdf: \u0026lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#\u0026gt; 3PREFIX rdfs: \u0026lt;http://www.w3.org/2000/01/rdf-schema#\u0026gt; 4PREFIX class: \u0026lt;https://mediaarts-db.bunka.go.jp/data/class#\u0026gt; 5SELECT 6\t?col ?genre ?colName ?actors 7WHERE { 8 ?col a ?animeColClasses ; 9 schema:name ?colName ; 10 schema:genre ?genre ; 11 schema:actor ?actors . 12 VALUES ?animeColClasses {class:AnimationTVRegularSeries class:AnimationTVSpecialSeries class:AnimationMovieSeries} 13 FILTER(LANG(?colName) = \u0026#34;\u0026#34;) 14 FILTER(REGEX(?actors, CONCAT(\u0026#34;【\u0026#34;, ?colName ,\u0026#34;】\u0026#34;))) 15} ▶ 実行する "},{"id":2,"href":"/docs/federated_query/","title":"複数エンドポイントの横断的活用","section":"Docs","content":" 複数エンドポイントの横断的活用 # SPARQLでは、1つのエンドポイントだけでなく、外部の複数のエンドポイントに対してクエリを実行することができるfederatedクエリという仕組みがあります。\nfederatedクエリを利用したクエリを紹介します。\nSPARQLクエリエディタ # クエリ集 # メディア芸術データベースの責任主体の法人番号を取得する # Wikidataとメディア芸術データベースを連携したfederatedクエリ\n法人番号からさらにgBizINFOのSPARQLエンドポイントなどとも繋げられそうですね。\n1PREFIX schema: \u0026lt;https://schema.org/\u0026gt; 2PREFIX class: \u0026lt;https://mediaarts-db.bunka.go.jp/data/class#\u0026gt; 3PREFIX ma: \u0026lt;https://mediaarts-db.bunka.go.jp/data/property#\u0026gt; 4 5SELECT 6 ?agent ?name ?hojinBangou 7WHERE { 8 ?agent a class:Agent; 9 schema:name ?name ; 10 ma:wikidata ?wikidataPage . 11 # WikidataのリソースURIに変換 12 BIND (URI(REPLACE(?wikidataPage, \u0026#34;https://www.wikidata.org/wiki/\u0026#34;, \u0026#34;http://www.wikidata.org/entity/\u0026#34;)) AS ?wikidataEntity) 13 14 # Wikidata 15 SERVICE \u0026lt;https://query.wikidata.org/sparql\u0026gt; { 16 # P3225: 法人番号 17 ?wikidataEntity \u0026lt;http://www.wikidata.org/prop/direct/P3225\u0026gt; ?hojinBangou ; 18 } 19} 20LIMIT 100 ▶ 実行する 「日本ゲーム大賞」を受賞したゲームを取得する # DBpedia JapaneseとWikidataとメディア芸術データベースを連携したfederatedクエリ\n1PREFIX rdfs: \u0026lt;http://www.w3.org/2000/01/rdf-schema#\u0026gt; 2PREFIX owl: \u0026lt;http://www.w3.org/2002/07/owl#\u0026gt; 3PREFIX dcterms: \u0026lt;http://purl.org/dc/terms/\u0026gt; 4PREFIX schema: \u0026lt;https://schema.org/\u0026gt; 5PREFIX skos: \u0026lt;http://www.w3.org/2004/02/skos/core#\u0026gt; 6PREFIX class: \u0026lt;https://mediaarts-db.bunka.go.jp/data/class#\u0026gt; 7PREFIX ma: \u0026lt;https://mediaarts-db.bunka.go.jp/data/property#\u0026gt; 8PREFIX wdt: \u0026lt;http://www.wikidata.org/prop/direct/\u0026gt; 9PREFIX hint: \u0026lt;http://aws.amazon.com/neptune/vocab/v01/QueryHints#\u0026gt; 10 11SELECT 12 ?MADBID ?genre ?label 13WHERE { 14 hint:Query hint:joinOrder \u0026#34;Ordered\u0026#34; . 15 # DBpedia Japanese 16 SERVICE \u0026lt;https://ja.dbpedia.org/sparql\u0026gt; { 17 SELECT DISTINCT 18 (URI(REPLACE(STR(?wikidataEntity), \u0026#34;http://wikidata.dbpedia.org/resource/\u0026#34;, \u0026#34;http://www.wikidata.org/entity/\u0026#34;)) 19 AS ?wikidataEntity) 20 { 21 \u0026lt;http://ja.dbpedia.org/resource/Category:日本ゲーム大賞受賞ソフト\u0026gt; ^skos:broader* ?category . 22 ?dbpediaEntity dcterms:subject ?category; 23 ^owl:sameAs ?wikidataEntity . 24 FILTER(STRSTARTS(STR(?wikidataEntity), \u0026#34;http://wikidata.dbpedia.org/resource/\u0026#34;)) 25 } 26 } 27 # Wikidata 28 SERVICE \u0026lt;https://query.wikidata.org/sparql\u0026gt; { 29 # P7886: メディア芸術データベース識別子 30 ?wikidataEntity wdt:P7886 ?MADBID . 31 } 32 # メディア芸術データベース 33 ?MADBResource schema:identifier ?MADBID ; 34 schema:genre ?genre ; 35 rdfs:label ?label . 36} 37LIMIT 100 ▶ 実行する federatedクエリの実行順序によっては、正しく結果が得られないことがあります。\nRDFストアによっては、クエリオプティマイザに実行順序を指示する方法が用意されており、メディア芸術データベースのSPARQLクエリサービスが使用しているAmazon Neptuneでは hint:Query hint:joinOrder \u0026quot;Ordered\u0026quot; . というパターンを記述します。\n参照: Amazon Neptune: SPARQL クエリヒント\n"}]